game_studios
  studio_id		pk
  studio_name

games
  game_id		pk
  studio_id		fk
  game_name
  game_price
  game_desc
  game_cover

order_details
  order_detail_id	pk
  order_id		fk
  game_id		fk

orders
  order_id		pk
  customer_id		fk
  order_total
  order_date

customer_games
  customer_id		pk/fk
  game_id		pk/fk

customers
  customer_id		pk
  email
  password

notes:
when customer orders successfully the download button on the game page is unlocked
customers.customer_id is incrementing on unsuccessful registration
register page shows password in source on failed registration (because sticky)
bold password format requirements on the register page
validation!!!
try changing session ids across pages - not really necessary
set session expiration across pages - already default to drop on browser exit

register
http://localhost/php-scripts/ch16-exercises/16.2/
http://localhost/php-scripts/ch09-exercises/9.5/

login
http://localhost/php-scripts/ch15-exercises/15.8-15.10/
http://localhost/php-scripts/ch12-pursue/htdocs/
http://localhost/php-scripts/ch12-exercises/12.12-12.13/

^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&'])[^ ]{8,}$

[A-Za-z0-9!@#$%^&]{8,}

preg_match("/[A-Za-z0-9!@#$%^&]{8,}/", $input_line, $output_array);

login process:
load login page
  on submit
    if incomplete, reload form
    else send to db

      else start session, store authorization cookie

start session
check if session[userid/token] is set
  user is logged in // do something ?? redirect ??
check if username and pass vars are not set
  if not set generate error
check if username is correct length
  if not correct generate error
check if password is correct length
  if not correct generate error
confirm username is alphanumeric
  if not valid generate error
confirm password is alphanumeric
  if not valid generate error
else no previous triggers
  get username and password with filtervar filtersanitizestring(check on other filters)
  encrypt password w/ sha1
  include db connection
  prepare statement
  bind params
  execute
  store/fetch result
  test if result was not set
    if not set generate error
  else store session[userid/token](user agent??) and redirect user to mygames/login success



SELECT customers.email FROM customers WHERE customers.email="" AND customers.pass=SHA1('');

 elseif (isset($_SESSION['agent']) && md5($_SERVER['HTTP_USER_AGENT']) != $_SESSION['agent']) {
	// attempt to access page with invalid session information
	// log user out
	// destroy session
	redirect_user(); // to login.php
}

($_SESSION['agent'] != md5($_SERVER['HTTP_USER_AGENT']))

==============

AAA Game Studio
  AAA Title 1
    39.99
    Hyperbole to the max! This game has almost no substance!
    aaatitle1.png
  AAA Title 2
    49.99
    The sequel to AAA Title 1! This game has less substance than the original!
    aaatitle2.png
  AAA Title 3
    59.99
    The prequel to AAA Title 1! Now you have the option to pay-to-win!
    aaatitle3.png

Indie Game Studio
  Indie Title 1
    1.99
    Our humble beginning as a game studio.
    indietitle1.png
  Indie Title 2
    2.99
    Our passion project brought to you by the proceeds from our first title.
    indietitle2.png
  Indie Title 3
    4.99
    We just changed gaming once again and everyone loves us!
    indietitle3.png

Passionate Game Studio
  Beloved Title
    9.99
    The game from a decade ago that everyone played and loved.
    belovedtitle.png
  Free Title
    0.00
    Get hooked on our games for free! Supported by cute outfits and cool weapons you can buy for your avatar!
    freetitle.png
  Innovative Title
    49.99
    The game that everyone is playing right now!
    innovativetitle.png

SELECT game_studios.studio_name, games.game_name, games.game_price, games.game_desc, games.game_cover
FROM game_studios
INNER JOIN games ON game_studios.studio_id=games.studio_id;

===

game pages

games directory with index.php that is linked to from game directories
  index.php determines which directory was called and populates game page
    eg: games/game1 is linked to games/gamepage where index.php will determine what link was called

===

store page

do a query for game names
replace spaces with -, make lowercase
  provides directories

===

changing db column name and values

ALTER TABLE games CHANGE game_cover game_dir VARCHAR(60) NOT NULL;

UPDATE games SET game_dir = '' WHERE game_id = ;

===

*get customer_id
INSERT INTO orders (orders.customer_id, orders.order_total)
VALUES ('$customer_id', '$total')

//returns customer_id from email
(SELECT customers.customer_id FROM customers WHERE customers.email='chris@mccauley.tech')

//returns game_id from game_dir
(SELECT games.game_id FROM games WHERE games.game_dir=('aaa-title1'))

INSERT INTO orders (orders.customer_id, orders.order_total, orders.order_date)
VALUES ();

//inserts customer_id and game_id into customer_games...
INSERT INTO customer_games (customer_games.customer_id, customer_games.game_id) VALUES ((SELECT customers.customer_id FROM customers WHERE customers.email='chris@mccauley.tech'), (SELECT games.game_id FROM games WHERE games.game_dir='aaa-title1'));

//get customer games dir names
select * from customer_games inner join customers on customer_games.customer_id=customers.customer_id;
select customer_games.game_id from customer_games where customer_games.customer_id=(select customers.customer_id from customers where customers.email='chris@mccauley.tech');

SELECT games.game_dir FROM games;

SELECT games.game_dir, customer_games.game_id FROM games RIGHT JOIN customer_games;

SELECT games.game_dir FROM games WHERE games.game_id IN (SELECT customer_games.game_id FROM customer_games WHERE customer_games.customer_id IN (SELECT customers.customer_id FROM customers WHERE customers.email='chris@mccauley.tech'));

SELECT games.game_dir, games.game_name FROM games WHERE games.game_id IN (SELECT customer_games.game_id FROM customer_games WHERE customer_games.customer_id IN (SELECT customers.customer_id FROM customers WHERE customers.email='chris@mccauley.tech'));
===
store
register
login
logout
mygames
  download
game-page
cart

indicate in mygames
continue shopping
header links

===
// declare and run query
// !!! MOVE TO FUNCTIONS !!! name: get_game_page()

$mysqli->real_escape_string($thisDirectory);
$q = "SELECT game_studios.studio_name, games.game_name, games.game_price, games.game_desc, games.game_dir FROM game_studios INNER JOIN games ON game_studios.studio_id=games.studio_id WHERE games.game_dir='$thisDirectory';";
$r = $mysqli->query($q);
$r = $r->fetch_assoc();
===
// !!! MOVE TO FUNCTIONS !!! name: set_customer_games()
        foreach($_SESSION['cart'] as $game) {
            $q = "INSERT INTO customer_games (customer_games.customer_id, customer_games.game_id) VALUES ((SELECT customers.customer_id FROM customers WHERE customers.email='" . $_SESSION['email'] . "'), (SELECT games.game_id FROM games WHERE games.game_dir='" . $game[2] . "'));";
            $mysqli->query($q);
            $_SESSION['games'][] = array($game[2], $game[0]);
        }

        // store order and order_details !!!

        // finished with cart
        unset($_SESSION['cart']);

        // redirect to mygames
        require('../redirect_user.php');
        redirect_user('mygames.php');
===
customer_id, order_total
order_id, game_id

INSERT INTO orders (orders.customer_id, orders.order_total) VALUES ((SELECT customers.customer_id FROM customers WHERE customers.email='" . $_SESSION['email'] . "'), $orderTotal);

INSERT INTO orders (orders.customer_id, orders.order_total) VALUES ((SELECT customers.customer_id FROM customers WHERE customers.email='chris@mccauley.tech'), 209.95);

get order id from query that looks up id of last order from that customer
SELECT orders.order_id FROM orders WHERE orders.customer_id=(SELECT customers.customer_id FROM customers WHERE customers.email='" . $_SESSION['email'] . "') ORDER BY orders.order_date DESC LIMIT 1;

INSERT INTO order_details (order_details.order_id, order_details.game_id) VALUES ((), ());

INSERT INTO order_details (order_details.order_id, order_details.game_id) VALUES ((SELECT orders.order_id FROM orders WHERE orders.customer_id=(SELECT customers.customer_id FROM customers WHERE customers.email='" . $_SESSION['email'] . "') ORDER BY orders.order_date DESC LIMIT 1;), ());